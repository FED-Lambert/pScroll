/*!
 * @project : 1433558936175
 * @version : 1.0.0
 * @author  : lixinliang
 * @update  : 2015-06-11 2:57:17 pm
 */!function(global,factory){var plugin="pScroll";"function"==typeof define?define(plugin,["zepto"],function(){return factory(Zepto)}):global[plugin]=factory(Zepto)}(this,function($){function pScroll(conf){this.speed=conf.speed,this.easing=conf.easing,this.axis=conf.axis,this.threshold=conf.threshold,this.loop=conf.loop,this.hash=conf.hash,this.delay=conf.delay,this.trigger=conf.trigger,this.prevent=conf.prevent,this.prevent&&$(document).on("touchmove",function(e){e.preventDefault()}),this.wrap=$(conf.wrap),this.slidestart=conf.slidestart,this.slideend=conf.slideend,this.pages=this.wrap.children(),this.length=this.pages.length,this.index=0,this.touching=!1,this.animating=!1,this.register=!1,this.startPos=0,this.movePos=0,this.endPos=0,this.startTS=0,this.pageSize="y"===this.axis?this.pages.height():this.pages.width(),this.size=this.pageSize*this.length;var direction="y"===this.axis?"height":"width";this.pages.css(direction,this.pageSize),this.wrap.css(direction,this.size),this.pagePos=[];for(var temp=0,temp=0,i=0;i<this.length;i++)this.pagePos.push([0-temp,1-temp-this.pageSize,0]),temp+=this.pageSize;if(this.topPage=0,this.hash){var hash=parseInt(location.hash.substring(1));hash=isNaN(hash)?0:hash,this.index=hash,0!==hash&&this.goStep(this.pagePos[hash][0])}this.init()}var handle=["prev","reload","next","goPage","goStep","on","off"],option={speed:500,easing:"ease-in-out",axis:"y",threshold:50,loop:!1,hash:!1,delay:!1,trigger:document,prevent:!0,wrap:$(),slidestart:function(){},slideend:function(){}},prototype={init:function(){var self=this,TF="-webkit-transform",TS="-webkit-transition",proto=this.wrap.__proto__,extend={transform:function(value){if("undefined"==typeof value){var ret,str=this.css(TF)||"",result=str.match(/translate\((.*)\)/);return result&&0!=result.length?ret=result[1].split(","):(this.css(TF,"translate(0,0)"),ret=[0,0]),parseInt(ret["y"===self.axis?1:0])}this.css(TF,"y"===self.axis?"translate(0,"+value+"px)":"translate("+value+"px,0)")},addTransition:function(){this.css(TS,TF+" "+self.speed+"ms "+self.easing)},removeTransition:function(){this.css(TS,TF+" 0 linear")}};extend.__proto__=proto,this.wrap.__proto__=extend,this.wrap.on("webkitTransitionEnd",function(){return self.animating&&(self.animating=!1,self.slideend.apply(self.pages[self.index],[self.index])),!1}),this.bind(),this.on()},getPos:function(e){var ev=e.changedTouches[0];return"y"===this.axis?ev.pageY:ev.pageX},touchstart:function(e){return this.animating?(this.touching=!1,void 0):(this.startPos=this.getPos(e),this.wrap.removeTransition(),this.startTS=this.wrap.transform(),this.touching=!0,void 0)},touchmove:function(e){if(!this.animating&&this.touching){if(e.preventDefault(),this.movePos=this.getPos(e),!this.loop){if(this.startTS===this.pagePos[0][0]&&this.movePos>this.startPos)return;if(this.startTS===this.pagePos[this.length-1][0]&&this.movePos<this.startPos)return}this.goStep(this.startTS+this.movePos-this.startPos)}},touchend:function(e){this.animating||(this.endPos=this.getPos(e),this.touching&&this.endPos!=this.startPos&&(this.endPos<this.startPos?Math.abs(this.endPos-this.startPos)>=this.threshold?this.next():this.reload():Math.abs(this.endPos-this.startPos)>=this.threshold?this.prev():this.reload()))},prev:function(){var index=this.index;this.loop?(index--,index%=this.length,0>index&&(index+=this.length),this.index==this.topPage&&this.pullUp()):0!=index&&index--,this.goPage(index)},reload:function(){this.goPage(this.index)},next:function(){var index=this.index;this.loop?(index++,index%=this.length,0>index&&(index+=this.length),index==this.topPage&&this.pullDown()):index!=this.length-1&&index++,this.goPage(index)},goPage:function(to){var from=this.index;to>=this.length?to=this.length-1:0>to&&(to=0),this.index=to,this.hash&&(location.hash="#"+to),this.wrap.addTransition(),this.wrap.transform(this.pagePos[to][0]),to!==from&&(this.animating=!0),this.slidestart.apply(this.pages[from],[to,from])},goStep:function(step){if(this.loop){var topLimit=this.pagePos[this.topPage][0];step>topLimit&&this.pullUp(),step<topLimit-this.size+this.pageSize&&this.pullDown()}this.wrap.transform(step)},pullUp:function(){0==this.topPage?this.topPage=this.length-1:this.topPage--;var counter=--this.pagePos[this.topPage][2];this.pagePos[this.topPage][0]+=this.size,this.pagePos[this.topPage][1]+=this.size,this.wrap.transform.call(this.pages.eq(this.topPage),counter*this.size)},pullDown:function(){var counter=++this.pagePos[this.topPage][2];this.pagePos[this.topPage][0]-=this.size,this.pagePos[this.topPage][1]-=this.size,this.wrap.transform.call(this.pages.eq(this.topPage),counter*this.size),this.topPage==this.length-1?this.topPage=0:this.topPage++},bind:function(){this.touchstart=this.touchstart.bind(this),this.touchmove=this.touchmove.bind(this),this.touchend=this.touchend.bind(this)},on:function(){this.register||(!this.delay&&$(this.trigger).on("touchmove",this.touchmove),$(this.trigger).on("touchstart",this.touchstart).on("touchend",this.touchend),this.register=!0)},off:function(){this.register&&(!this.delay&&$(this.trigger).off("touchmove",this.touchmove),$(this.trigger).off("touchstart",this.touchstart).off("touchend",this.touchend),this.register=!1)}};for(var i in prototype)pScroll.prototype[i]=prototype[i];return function(conf){if(!$(conf.wrap).children().length)throw new Error("pScroll require a wrapper with page(s)");for(var plugin=new pScroll($.extend({},option,conf)),ret={},i=0,l=handle.length;l>i;i++)ret[handle[i]]=function(name){var ret=plugin[name].apply(plugin,Array.prototype.slice.call(arguments,1));return"undefined"==typeof ret?this:ret}.bind(ret,handle[i]);return ret.plugin=plugin,ret}});